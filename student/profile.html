<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

	<meta name="keywords" content="">
	<meta name="description" content="">
    <meta name="author" content="templatemo">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- bootstrap -->
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<!-- font-awesome -->
	<link rel="stylesheet" href="/css/font-awesome.min.css">
	<!-- custom -->
	<link rel="stylesheet" href="/css/hoveretc.css">
	<!-- google font -->
	<link href='//fonts.googleapis.com/css?family=Signika:400,300,600,700' rel='stylesheet' type='text/css'>
	<link href='//fonts.googleapis.com/css?family=Chewy' rel='stylesheet' type='text/css'>

  <title>Profile</title>
</head>
<body id="home" data-spy="scroll" data-target=".navbar-collapse">
	<!-- start navigation -->
	<div class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="icon icon-bar"></span>
					<span class="icon icon-bar"></span>
					<span class="icon icon-bar"></span>
				</button>

			  <a href="index.html" class="navbar-brand smoothScroll"><h1>Profile<h1></a>
				
			</div>
			<div class="collapse navbar-collapse">
				<ul class="nav navbar-nav navbar-right">
					<li><a href="index.html" class="smoothScroll">DASHBOARD</a></li>
					<li><a href="profile.html" class="smoothScroll">PROFILE</a></li>
					<li><a href="requirements.html" class="smoothScroll">REQUIREMENTS</a></li>
					<li><a href="enrollment.html" class="smoothScroll">ENROLLMENT</a></li>
					<li><a href="change_password.html" class="smoothScroll">CHANGE PASSWORD</a></li>
					<li><a href="/index.html" class="smoothScroll">LOGOUT</a></li> 
				</ul>
			</div>
		</div>
	</div>

    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    
    <div class="container">
        <div class="col-md-6 col-md-offset-3"></div>
        <h2>Student Details</h2>
        <div class="row">
            
            <input type="hidden" id="firstname" value="">
            <input type="hidden" id="middlename" value="">
            <input type="hidden" id="lastname" value="">
            <input type="hidden" id="gradelevel" value="">
            <div class="col-md-12">
                <label for="student-number">Student Number:</label>
                <span id="student-number" class="data-field">123123123</span>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <label for="name">Name:</label>
                <span id="name" class="data-field">Testing name</span>
                <input type="text" id="nameInput" class="edit-field" style="display: none;">
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <label for="email">Email:</label>
                <span id="email" class="data-field">test@example.com</span>
                <input type="text" id="emailInput" class="edit-field" style="display: none;">
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <label for="dob">Date of Birth:</label>
                <span id="dob" class="data-field">03/10/1998</span>
                <input type="text" id="dobInput" class="edit-field" style="display: none;">
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <label for="grade-level">Grade Level:</label>
                <span id="grade-level" class="data-field">Grade 10</span>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <label for="address">Address:</label>
                <span id="address" class="data-field">123 Test Street</span>
                <input type="text" id="addressInput" class="edit-field" style="display: none;">
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <label for="contact-number">Contact Number:</label>
                <span id="contact-number" class="data-field">09123456789</span>
                <input type="text" id="contactNumberInput" class="edit-field" style="display: none;">
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <label for="username">Username:</label>
                <span id="username" class="data-field">testusername</span>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-md-6">
                <button id="updateProfileBtn" class="btn btn-primary" data-toggle="modal" data-target="#CreateStudent">Update Profile</button>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="CreateStudent" tabindex="-1" role="dialog" aria-labelledby="CreateStudentLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="CreateStudentLabel">UPDATE PROFILE</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="fname" class="col-form-label">First Name:</label>
                            <input type="text" class="form-control" id="fnamemodal">
                        </div>
                        <div class="form-group">
                            <label for="mname" class="col-form-label">Middle Name:</label>
                            <input type="text" class="form-control" id="mnamemodal">
                        </div>
                        <div class="form-group">
                            <label for="lname" class="col-form-label">Last Name:</label>
                            <input type="text" class="form-control" id="lnamemodal">
                        </div>
                        <div class="form-group">
                            <label for="email" class="col-form-label">Email:</label>
                            <input type="email" class="form-control" id="emailmodal">
                        </div>
                        <div class="form-group">
                            <label for="dob" class="col-form-label">Date of Birth:</label>
                            <input type="date" class="form-control" id="dobmodal">
                        </div>
                        <div class="form-group">
                            <label for="address" class="col-form-label">Address:</label>
                            <input type="text" class="form-control" id="addressmodal">
                        </div>
                        <div class="form-group">
                            <label for="contact-number" class="col-form-label">Contact Number:</label>
                            <input type="tel" class="form-control" id="contact-numbermodal" pattern="09[0-9]{9}">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="updateStudent()">Update Profile</button>
                </div>
            </div>
        </div>
    </div>

<script src="/js/logout.js"></script>
<script src="/js/student.js"></script>
<script src="/js/jquery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/plugins.js"></script>
<script src="/js/smoothscroll.js"></script>
<script src="/js/api.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
      GetUserTable();
      document.getElementById("updateProfileBtn").addEventListener("click", function(){
        var dob = document.getElementById("dob").textContent;
        var parts = dob.split("/"); // Split the date string into an array [month, day, year]
        var formattedDate = new Date(parts[2], parts[0] - 1, parts[1]).toLocaleDateString('en-CA');

        console.log(formattedDate); // Output: "1997-10-09"

        document.getElementById("emailmodal").value = document.getElementById("email").textContent;
        document.getElementById("dobmodal").value = formattedDate;
        document.getElementById("addressmodal").value = document.getElementById("address").textContent;
        document.getElementById("contact-numbermodal").value = document.getElementById("contact-number").textContent;
        document.getElementById("fnamemodal").value = document.getElementById("firstname").value;
        document.getElementById("lnamemodal").value = document.getElementById("lastname").value;
        document.getElementById("mnamemodal").value = document.getElementById("middlename").value;
      });
  });        

  function GetUserTable() {
    var url = endpoint + "/readStudent"

    var readStudent = {
        UserID : parseInt(sessionStorage.getItem("UserID"))
    };

    console.log(readStudent);

    fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(readStudent)
      })
      .then(function(response) {
        if (response.ok) {
          return response.json();
        } else {
          throw new Error('Request failed with status:', response.status);
        }
      })
      .then(function(data) {
        console.log(data);
        
        document.getElementById("student-number").textContent = data.StudentNumber;
        document.getElementById("name").textContent = data.Name;
        document.getElementById("email").textContent = data.Email;
        document.getElementById("dob").textContent = data.DateOfBirth;
        document.getElementById("grade-level").textContent = data.GradeLevel;
        document.getElementById("address").textContent = data.Address;
        document.getElementById("contact-number").textContent = data.ContactNumber;
        document.getElementById("username").textContent = data.StudentNumber;
        document.getElementById("firstname").value = data.FirstName;
        document.getElementById("lastname").value = data.LastName;
        document.getElementById("middlename").value = data.MiddleName;
        document.getElementById("gradelevel").value = data.GradeLevel;

      })
      .catch(function(error) {
        alert(error);
      });
  }

  function updateStudent(){
    var url = endpoint + "/updateStudent"

var dateObj = new Date(document.getElementById("dobmodal").value);
var month = (dateObj.getMonth() + 1).toString().padStart(2, '0'); // Adding 1 because months are zero-indexed
var day = dateObj.getDate().toString().padStart(2, '0');
var year = dateObj.getFullYear().toString();

var formattedDateReq = month + '/' + day + '/' + year;
console.log(formattedDateReq);

var updateStudent = {
  StudentNumber: parseInt(document.getElementById("student-number").textContent),
  UserID: parseInt(sessionStorage.getItem("UserID")),
  FirstName: document.getElementById("fnamemodal").value,
  MiddleName: document.getElementById("mnamemodal").value,
  LastName: document.getElementById("lnamemodal").value,
  Email: document.getElementById("emailmodal").value,
  DateOfBirth: formattedDateReq,
  GradeLevel: document.getElementById("gradelevel").value,
  Address: document.getElementById("addressmodal").value,
  ContactNumber: document.getElementById("contact-numbermodal").value
}

    console.log(updateStudent);

    fetch(url, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify(updateStudent)
    })
    .then(function(response) {
        if (response.ok) {
        return response.json();
        } else {
        throw new Error('Request failed with status:', response.status);
        }
    })
    .then(function(data) {
        // Handle the response here
        console.log(data);
        GetUserTable();
    })
    .catch(function(error) {
        alert(error);
    });
  }
</script>

</body>
</html>

